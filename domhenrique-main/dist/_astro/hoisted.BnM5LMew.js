import"./hoisted.BB7YPW27.js";import{c as ne,e as w,h as se,q as Q,f as N,w as U,k as W,l as oe}from"./firebase.CHVcsD2z.js";const F=document.querySelectorAll("[data-filter]"),q=Array.from(document.querySelectorAll(".gallery-item")),k=document.getElementById("gallery-prev"),j=document.getElementById("gallery-next"),_=document.getElementById("gallery-page-indicator"),z=document.getElementById("gallery-pagination");let I="Todos",m=1;const L=6;function M(){const a=q.filter(s=>I==="Todos"||s.dataset.category===I),e=Math.ceil(a.length/L)||1;m>e&&(m=e);const r=(m-1)*L,t=r+L;q.forEach(s=>s.style.display="none"),a.forEach((s,l)=>{l>=r&&l<t&&(s.style.display="block")}),_&&(_.textContent=`Página ${m} de ${e}`),k&&(k.disabled=m===1),j&&(j.disabled=m===e),z&&(z.style.display=e>1?"flex":"none")}F.forEach(a=>{a.addEventListener("click",()=>{F.forEach(e=>{e.classList.remove("bg-primary","text-white"),e.classList.add("bg-white","text-gray-600")}),a.classList.remove("bg-white","text-gray-600"),a.classList.add("bg-primary","text-white"),I=a.dataset.filter,m=1,M()})});k?.addEventListener("click",()=>{m>1&&(m--,M(),document.getElementById("galeria").scrollIntoView({behavior:"smooth"}))});j?.addEventListener("click",()=>{const a=q.filter(r=>I==="Todos"||r.dataset.category===I).length,e=Math.ceil(a/L);m<e&&(m++,M(),document.getElementById("galeria").scrollIntoView({behavior:"smooth"}))});M();const D=document.getElementById("reservation-form"),p=document.getElementById("res-date"),b=document.getElementById("res-time"),v=document.getElementById("slots-container"),B=document.getElementById("contact-step"),G=document.getElementById("date-error"),X=document.getElementById("success-message"),re=document.getElementById("reset-form"),P=document.getElementById("loading-overlay"),f=document.getElementById("res-guests"),ie=30;let o={closedDays:[0,1],maxGuests:8,minAdvance:30,resDuration:60,vacationStart:null,vacationEnd:null,lunch:{start:12,end:15},dinner:{start:19,end:22},tables:[]};const le=ne(w,"settings","general");se(le,a=>{if(a.exists()){const e=a.data();e.closedDays&&(o.closedDays=e.closedDays),e.maxGuests&&(o.maxGuests=e.maxGuests),e.minAdvance!==void 0&&(o.minAdvance=e.minAdvance),e.resDuration!==void 0&&(o.resDuration=e.resDuration),o.vacationStart=e.vacationStart||null,o.vacationEnd=e.vacationEnd||null,e.lunchStart&&(o.lunch.start=e.lunchStart),e.lunchEnd&&(o.lunch.end=e.lunchEnd),e.dinnerStart&&(o.dinner.start=e.dinnerStart),e.dinnerEnd&&(o.dinner.end=e.dinnerEnd),o.tables=e.tables||[],ce(),p.value&&$(p.value)}});function ce(){const a=parseInt(f.value)||2;f.innerHTML="";for(let r=1;r<=o.maxGuests;r++){const t=document.createElement("option");t.value=r.toString(),t.textContent=r+(r===1?" Pessoa":" Pessoas"),f.appendChild(t)}const e=Math.min(a,o.maxGuests);f.value=e>0?e.toString():"1"}function de(a,e){if(e.find(s=>s.capacity>=a))return!0;const t=e.filter(s=>s.combinable!==!1);for(let s=0;s<t.length;s++)for(let l=s+1;l<t.length;l++)if(t[s].capacity+t[l].capacity>=a)return!0;if(t.length>=3){for(let s=0;s<t.length;s++)for(let l=s+1;l<t.length;l++)for(let d=l+1;d<t.length;d++)if(t[s].capacity+t[l].capacity+t[d].capacity>=a)return!0}return!1}function ue(a,e){const r=e.filter(n=>n.capacity>=a).sort((n,i)=>n.capacity-i.capacity);if(r.length>0)return{tables:[r[0]],totalCapacity:r[0].capacity};const t=e.filter(n=>n.combinable!==!1);let s=null,l=1/0;for(let n=0;n<t.length;n++)for(let i=n+1;i<t.length;i++){const u=t[n].capacity+t[i].capacity;u>=a&&u<l&&(s=[t[n],t[i]],l=u)}if(s)return{tables:s,totalCapacity:l};let d=null,c=1/0;if(t.length>=3)for(let n=0;n<t.length;n++)for(let i=n+1;i<t.length;i++)for(let u=i+1;u<t.length;u++){const g=t[n].capacity+t[i].capacity+t[u].capacity;g>=a&&g<c&&(d=[t[n],t[i],t[u]],c=g)}return d?{tables:d,totalCapacity:c}:null}function J(a){const e=[];let r=a.start*60;const t=a.end*60;for(;r<t;){const s=Math.floor(r/60),l=r%60,d=`${s.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`;e.push(d),r+=ie}return e}p.min=new Date().toISOString().split("T")[0];p.addEventListener("change",a=>{$(a.target.value)});f.addEventListener("change",()=>{p.value&&$(p.value)});async function $(a){if(!a)return;const r=new Date(a).getDay();if(v.innerHTML='<div class="col-span-4 text-center py-2"><span class="animate-pulse text-primary">Verificando disponibilidade...</span></div>',b.value="",B.classList.add("hidden"),G.classList.add("hidden"),o.closedDays.includes(r)){K("O restaurante encontra-se encerrado. Não é possível efetuar reservas.");return}if(o.vacationStart&&o.vacationEnd){const c=new Date(o.vacationStart),n=new Date(o.vacationEnd);c.setHours(0,0,0,0),n.setHours(23,59,59,999);const i=new Date(a);if(i.setHours(12,0,0,0),i>=c&&i<=n){K("Estamos encerrados para férias neste período.");return}}let t=[];try{const c=Q(N(w,"reservations"),U("date","==",a));(await W(c)).forEach(i=>{const u=i.data();t.push({time:u.time,assignedTable:u.assignedTable||null})})}catch(c){console.error("Error fetching availability:",c)}if(!o.tables||o.tables.length===0){v.innerHTML='<div class="col-span-4 text-center text-red-500 bg-red-50 p-4 rounded-lg border border-red-100 text-sm">O restaurante ainda não configurou as mesas. Por favor, tente mais tarde.</div>';return}v.innerHTML="";const s=J(o.lunch),l=J(o.dinner),d=[...s,...l];if(d.length===0){v.innerHTML='<div class="col-span-4 text-center text-gray-500 py-2">Não há horários disponíveis para hoje.</div>';return}d.forEach(c=>{const n=document.createElement("button");n.type="button",n.className="py-2 px-3 rounded border text-sm transition-all hover:border-primary hover:bg-primary/5",n.textContent=c;const[i,u]=c.split(":").map(Number),g=new Date(a);g.setHours(i,u,0,0);const C=new Date,y=o.minAdvance*60*1e3;if(g.getTime()-C.getTime()<y)n.disabled=!0,n.classList.add("bg-gray-100","text-gray-400","cursor-not-allowed","line-through"),n.title="Horário já passou ou muito próximo";else{const E=parseInt(f.value),A=i*60+u,S=o.resDuration||60,x=[];t.forEach(T=>{if(T.assignedTable){const[Y,Z]=T.time.split(":").map(Number),V=Y*60+Z,ee=V+S,R=A,te=R+S;if(V<te&&R<ee){const ae=T.assignedTable.split("+");x.push(...ae)}}});const H=o.tables.filter(T=>!x.includes(T.id));de(E,H)?n.onclick=()=>me(n,c):(n.disabled=!0,n.classList.add("bg-gray-100","text-gray-400","cursor-not-allowed","line-through"),n.title="Esgotado")}v.appendChild(n)})}function K(a){v.innerHTML="",G.textContent=a,G.classList.remove("hidden"),p.value=""}function me(a,e){Array.from(v.children).forEach(r=>{r.disabled||(r.className="py-2 px-3 rounded border text-sm transition-all hover:border-primary hover:bg-primary/5")}),a.className="py-2 px-3 rounded border bg-primary text-white border-primary shadow-md",b.value=e,B.classList.remove("hidden"),setTimeout(()=>B.classList.add("opacity-100"),50)}D.addEventListener("submit",async a=>{if(a.preventDefault(),!b.value){alert("Por favor selecione um horário");return}P.classList.remove("hidden");try{const e={date:p.value,time:b.value,guests:f.value,name:document.getElementById("res-name").value,email:document.getElementById("res-email").value,phone:document.getElementById("res-phone").value,createdAt:new Date,to:[document.getElementById("res-email").value],cc:["restaurantedomhenrique@iol.pt"],message:{subject:`Reserva Confirmada - Dom Henrique (${p.value})`,html:`
                    <div style="font-family: sans-serif; color: #333;">
                        <h2 style="color: #b91c1c;">Reserva Confirmada</h2>
                        <p>Olá <strong>${document.getElementById("res-name").value}</strong>,</p>
                        <p>A sua reserva no <strong>Restaurante Dom Henrique</strong> foi registada com sucesso.</p>
                        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
                        <ul>
                            <li><strong>Data:</strong> ${p.value}</li>
                            <li><strong>Hora:</strong> ${b.value}</li>
                            <li><strong>Pessoas:</strong> ${f.value}</li>
                        </ul>
                        <p>Se precisar de cancelar, por favor contacte-nos por telefone: 252 996 426.</p>
                        <p><em>Obrigado pela preferência!</em></p>
                    </div>
                `}};if(o.tables&&o.tables.length>0){const r=parseInt(f.value),t=b.value,[s,l]=t.split(":").map(Number),d=s*60+l,c=o.resDuration||60,n=d+c,i=Q(N(w,"reservations"),U("date","==",p.value)),u=await W(i),g=[];u.forEach(h=>{const E=h.data();if(E.assignedTable){const[A,S]=E.time.split(":").map(Number),x=A*60+S,H=x+c;if(x<n&&d<H){const O=E.assignedTable.split("+");g.push(...O)}}});const C=o.tables.filter(h=>!g.includes(h.id)),y=ue(r,C);if(!y){alert("Desculpe, não há mesas disponíveis para este período. Por favor escolha outro horário."),P.classList.add("hidden");return}y.tables.length===1?(e.assignedTable=y.tables[0].id,e.assignedTableName=y.tables[0].name):(e.assignedTable=y.tables.map(h=>h.id).join("+"),e.assignedTableName=y.tables.map(h=>h.name).join(" + "))}await oe(N(w,"reservations"),e),D.classList.add("hidden"),X.classList.remove("hidden")}catch(e){console.error("Error writing document: ",e),alert("Ocorreu um erro ao registar a reserva.")}finally{P.classList.add("hidden")}});re.addEventListener("click",()=>{D.reset(),v.innerHTML='<div class="col-span-4 text-gray-400 text-sm italic p-2 border border-dashed rounded text-center">Selecione uma data para ver disponibilidade</div>',b.value="",B.classList.add("hidden","opacity-0"),D.classList.remove("hidden"),X.classList.add("hidden")});
