---
import { restaurantConfig } from '../data/config.js';
---

<!-- Reservation Section - Lilia Style -->
<section id="reservas" class="py-32 md:py-40 bg-neutral-900 text-white relative overflow-hidden">
  
  <!-- Decorative Elements -->
  <div class="absolute top-0 left-0 w-64 h-64 bg-gold/5 rounded-full blur-3xl"></div>
  <div class="absolute bottom-0 right-0 w-96 h-96 bg-gold/5 rounded-full blur-3xl"></div>
  
  <div class="container mx-auto px-8 max-w-5xl relative z-10">
    
    <!-- Header -->
    <div class="text-center mb-16 reveal">
      <span class="text-gold uppercase tracking-[0.3em] text-sm font-medium">Reservas Online</span>
      <h2 class="text-4xl md:text-5xl lg:text-6xl font-serif font-light mt-4 mb-4">
        Reserve a sua mesa
      </h2>

    </div>

    <!-- Main Card -->
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden reveal">
      <div class="grid md:grid-cols-5">
        
        <!-- Info Panel -->
        <div class="md:col-span-2 bg-neutral-800 p-8 md:p-10 text-white">
          <h3 class="text-xl font-serif text-gold mb-8">Informações</h3>
          
          <div class="space-y-8">
            <!-- Hours -->
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 bg-gold/20 rounded-lg flex items-center justify-center text-gold shrink-0">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div>
                <h4 class="font-medium text-white mb-2">Horário</h4>
                <div class="space-y-1 text-sm text-gray-400">
                  <p><span class="text-gold font-medium">{restaurantConfig.hours.segunda_terca}</span> Seg/Ter</p>
                  <p>{restaurantConfig.hours.quarta_quinta} Qua/Qui</p>
                  <p>{restaurantConfig.hours.sexta_sabado} Sex/Sáb</p>
                  <p>{restaurantConfig.hours.domingo} Dom</p>
                </div>
              </div>
            </div>

            <!-- Phone -->
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 bg-gold/20 rounded-lg flex items-center justify-center text-gold shrink-0">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
              </div>
              <div>
                <h4 class="font-medium text-white mb-2">Telefone</h4>
                <a href={`tel:${restaurantConfig.contact.phone.replace(/\s/g, '')}`} class="text-gold hover:text-white transition-colors">
                  {restaurantConfig.contact.phone}
                </a>
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div class="mt-10 pt-6 border-t border-gray-700">
            <div class="space-y-3 text-xs text-gray-500">
              <p>* Apenas são tolerados 15 minutos de atraso. Por favor, informe-nos em caso de atraso para encontrarmos a melhor solução.</p>
              <p>* Para grupos > 10 pessoas, contacte-nos por telefone.</p>
            </div>
          </div>
        </div>

        <!-- Form Panel -->
        <div class="md:col-span-3 p-8 md:p-10 bg-white text-gray-800 relative">
          <!-- Loading Overlay -->
          <div id="loading-overlay" class="absolute inset-0 bg-white/90 backdrop-blur-sm z-50 hidden flex-col items-center justify-center">
            <div class="animate-spin rounded-full h-12 w-12 border-2 border-gold border-t-transparent"></div>
            <p class="mt-4 text-gray-500 text-sm">A processar...</p>
          </div>

          <form id="reservation-form" class="space-y-8">
            <!-- Step 1: Date & Guests -->
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-2 uppercase tracking-wider">Data</label>
                <input 
                  type="date" 
                  id="res-date"
                  required
                  class="w-full px-4 py-4 rounded-lg border border-gray-200 focus:border-gold focus:ring-2 focus:ring-gold/20 outline-none transition-all text-gray-900 bg-neutral-50"
                />
                <p class="text-xs text-red-500 mt-2 hidden" id="date-error"></p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-2 uppercase tracking-wider">Pessoas</label>
                <select id="res-guests" class="w-full px-4 py-4 rounded-lg border border-gray-200 focus:border-gold focus:ring-2 focus:ring-gold/20 outline-none transition-all text-gray-900 bg-neutral-50">
                  {[1, 2, 3, 4, 5, 6, 7, 8].map(n => <option value={n}>{n} {n === 1 ? 'Pessoa' : 'Pessoas'}</option>)}
                </select>
              </div>
            </div>

            <!-- Step 2: Time Slots -->
            <div>
              <label class="block text-sm font-medium text-gray-600 mb-3 uppercase tracking-wider">Horário</label>
              <div id="slots-container" class="grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-5 gap-2">
                <div class="col-span-full text-gray-400 text-sm italic p-4 border border-dashed border-gray-200 rounded-lg text-center bg-neutral-50">
                  Selecione uma data para ver disponibilidade
                </div>
              </div>
              <input type="hidden" id="res-time" required />
            </div>

            <!-- Step 3: Contact Info (Hidden until slot selected) -->
            <div id="contact-step" class="space-y-6 hidden opacity-0 transition-all duration-500">
              <div class="border-t border-gray-100 pt-8">
                <h4 class="text-sm uppercase tracking-wider text-gold font-medium mb-6">Seus Dados</h4>
                
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-600 mb-2">Nome Completo</label>
                    <input 
                      type="text" 
                      id="res-name"
                      required
                      placeholder="O seu nome"
                      class="w-full px-4 py-4 rounded-lg border border-gray-200 focus:border-gold focus:ring-2 focus:ring-gold/20 outline-none transition-all bg-neutral-50"
                    />
                  </div>
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-gray-600 mb-2">Email</label>
                      <input 
                        type="email" 
                        id="res-email"
                        required
                        placeholder="seu@email.com"
                        class="w-full px-4 py-4 rounded-lg border border-gray-200 focus:border-gold focus:ring-2 focus:ring-gold/20 outline-none transition-all bg-neutral-50"
                      />
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-600 mb-2">Telefone</label>
                      <input 
                        type="tel" 
                        id="res-phone"
                        required
                        placeholder="912 345 678"
                        class="w-full px-4 py-4 rounded-lg border border-gray-200 focus:border-gold focus:ring-2 focus:ring-gold/20 outline-none transition-all bg-neutral-50"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- Submit Button -->
              <button 
                type="submit" 
                class="w-full bg-gold hover:bg-accent text-white font-medium py-4 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300 uppercase tracking-wider"
              >
                Confirmar Reserva
              </button>
            </div>
          </form>

          <!-- Success Message (Hidden) -->
          <div id="success-message" class="hidden text-center py-16">
            <div class="w-20 h-20 bg-green-100 text-green-500 rounded-full flex items-center justify-center mx-auto mb-6">
              <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
            </div>
            <h3 class="text-3xl font-serif font-light text-gray-900 mb-3">Reserva Confirmada!</h3>
            <p class="text-gray-500 mb-8">
              Obrigado pela sua preferência.
            </p>
            <p class="text-xs text-gray-400 mb-8">
              Reserva confirmada sujeita a disponibilidade. Serão contactados em caso de necessidade de ajuste.
            </p>
            <button id="reset-form" class="text-gold font-medium hover:underline uppercase tracking-wider text-sm">
              Fazer nova reserva
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { restaurantConfig } from "../data/config.js";
  import { db } from "../lib/firebase.js";
  import { collection, addDoc, query, where, getDocs, doc, onSnapshot } from "firebase/firestore";

  const form = document.getElementById('reservation-form');
  const dateInput = document.getElementById('res-date') as HTMLInputElement;
  const timeInput = document.getElementById('res-time') as HTMLInputElement;
  const slotsContainer = document.getElementById('slots-container');
  const contactStep = document.getElementById('contact-step');
  const dateError = document.getElementById('date-error');
  const successMessage = document.getElementById('success-message');
  const resetButton = document.getElementById('reset-form');
  const loadingOverlay = document.getElementById('loading-overlay');
  const guestSelect = document.getElementById('res-guests') as HTMLSelectElement;

  // CONFIG & STATE
  const SLOT_INTERVAL = 30; // minutes
  let currentSettings = {
      closedDays: [0, 1],
      maxGuests: 8,
      minAdvance: 30, // minutes
      resDuration: 60, // minutes
      vacationStart: null,
      vacationEnd: null,
      lunch: { start: 12, end: 15 },
      dinner: { start: 19, end: 22 },
      tables: []
  };

  // 1. REAL-TIME SETTINGS LISTENER
  const settingsDoc = doc(db, "settings", "general");
  onSnapshot(settingsDoc, (snap) => {
      if (snap.exists()) {
          const s = snap.data();
          
          if (s.closedDays) currentSettings.closedDays = s.closedDays;
          if (s.maxGuests) currentSettings.maxGuests = s.maxGuests;
          if (s.minAdvance !== undefined) currentSettings.minAdvance = s.minAdvance;
          if (s.resDuration !== undefined) currentSettings.resDuration = s.resDuration;
          currentSettings.vacationStart = s.vacationStart || null;
          currentSettings.vacationEnd = s.vacationEnd || null;

          if (s.lunchStart) currentSettings.lunch.start = s.lunchStart;
          if (s.lunchEnd) currentSettings.lunch.end = s.lunchEnd;
          if (s.dinnerStart) currentSettings.dinner.start = s.dinnerStart;
          if (s.dinnerEnd) currentSettings.dinner.end = s.dinnerEnd;
          
          currentSettings.tables = s.tables || [];

          updateGuestSelect();

          if (dateInput.value) {
              refreshAvailability(dateInput.value);
          }
      }
  });

  function updateGuestSelect() {
      const currentVal = parseInt(guestSelect.value) || 2;
      guestSelect.innerHTML = '';
      for (let i = 1; i <= currentSettings.maxGuests; i++) {
          const option = document.createElement('option');
          option.value = i.toString();
          option.textContent = i + (i === 1 ? " Pessoa" : " Pessoas");
          guestSelect.appendChild(option);
      }
      const newVal = Math.min(currentVal, currentSettings.maxGuests);
      guestSelect.value = newVal > 0 ? newVal.toString() : "1";
  }

  function canAccommodateGuests(guestCount, availableTables) {
      const singleTable = availableTables.find(t => t.capacity >= guestCount);
      if (singleTable) return true;
      
      const combinableTables = availableTables.filter(t => t.combinable !== false);
      
      for (let i = 0; i < combinableTables.length; i++) {
          for (let j = i + 1; j < combinableTables.length; j++) {
              const combinedCapacity = combinableTables[i].capacity + combinableTables[j].capacity;
              if (combinedCapacity >= guestCount) return true;
          }
      }
      
      if (combinableTables.length >= 3) {
          for (let i = 0; i < combinableTables.length; i++) {
              for (let j = i + 1; j < combinableTables.length; j++) {
                  for (let k = j + 1; k < combinableTables.length; k++) {
                      const combinedCapacity = combinableTables[i].capacity + combinableTables[j].capacity + combinableTables[k].capacity;
                      if (combinedCapacity >= guestCount) return true;
                  }
              }
          }
      }
      
      return false;
  }

  function findBestTableSolution(guestCount, availableTables) {
      const singleTables = availableTables
          .filter(t => t.capacity >= guestCount)
          .sort((a, b) => a.capacity - b.capacity);
      
      if (singleTables.length > 0) {
          return { tables: [singleTables[0]], totalCapacity: singleTables[0].capacity };
      }
      
      const combinableTables = availableTables.filter(t => t.combinable !== false);
      
      let bestPair = null;
      let bestPairCapacity = Infinity;
      
      for (let i = 0; i < combinableTables.length; i++) {
          for (let j = i + 1; j < combinableTables.length; j++) {
              const combinedCapacity = combinableTables[i].capacity + combinableTables[j].capacity;
              if (combinedCapacity >= guestCount && combinedCapacity < bestPairCapacity) {
                  bestPair = [combinableTables[i], combinableTables[j]];
                  bestPairCapacity = combinedCapacity;
              }
          }
      }
      
      if (bestPair) {
          return { tables: bestPair, totalCapacity: bestPairCapacity };
      }
      
      let bestTrio = null;
      let bestTrioCapacity = Infinity;
      
      if (combinableTables.length >= 3) {
          for (let i = 0; i < combinableTables.length; i++) {
              for (let j = i + 1; j < combinableTables.length; j++) {
                  for (let k = j + 1; k < combinableTables.length; k++) {
                      const combinedCapacity = combinableTables[i].capacity + combinableTables[j].capacity + combinableTables[k].capacity;
                      if (combinedCapacity >= guestCount && combinedCapacity < bestTrioCapacity) {
                          bestTrio = [combinableTables[i], combinableTables[j], combinableTables[k]];
                          bestTrioCapacity = combinedCapacity;
                      }
                  }
              }
          }
      }
      
      if (bestTrio) {
          return { tables: bestTrio, totalCapacity: bestTrioCapacity };
      }
      
      return null;
  }

  function generateSlots(service) {
    const slots = [];
    let current = service.start * 60; 
    const end = service.end * 60;
    
    while (current < end) {
      const h = Math.floor(current / 60);
      const m = current % 60;
      const timeString = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
      slots.push(timeString);
      current += SLOT_INTERVAL;
    }
    return slots;
  }

  dateInput.min = new Date().toISOString().split('T')[0];
  
  dateInput.addEventListener('change', (e) => {
      refreshAvailability((e.target as HTMLInputElement).value);
  });

  guestSelect.addEventListener('change', () => {
      if (dateInput.value) {
          refreshAvailability(dateInput.value);
      }
  });

  async function refreshAvailability(dateStr) {
      if (!dateStr) return;

      const date = new Date(dateStr);
      const day = date.getDay();

      slotsContainer.innerHTML = '<div class="col-span-full text-center py-4"><span class="animate-pulse text-gold">Verificando disponibilidade...</span></div>';
      timeInput.value = '';
      contactStep.classList.add('hidden');
      dateError.classList.add('hidden');

      if (currentSettings.closedDays.includes(day)) {
          showError("O restaurante encontra-se encerrado neste dia.");
          return;
      }

      if (currentSettings.vacationStart && currentSettings.vacationEnd) {
          const start = new Date(currentSettings.vacationStart);
          const end = new Date(currentSettings.vacationEnd);
          start.setHours(0,0,0,0);
          end.setHours(23,59,59,999);
          const selected = new Date(dateStr);
          selected.setHours(12,0,0,0);

          if (selected >= start && selected <= end) {
              showError("Estamos encerrados para férias neste período.");
              return;
          }
      }

      let takenSlots = [];
      try {
          const q = query(collection(db, "reservations"), where("date", "==", dateStr));
          const querySnapshot = await getDocs(q);
          querySnapshot.forEach((doc) => {
              const data = doc.data();
              takenSlots.push({
                  time: data.time,
                  assignedTable: data.assignedTable || null
              });
          });
      } catch (err) {
          console.error("Error fetching availability:", err);
      }

      if (!currentSettings.tables || currentSettings.tables.length === 0) {
          slotsContainer.innerHTML = '<div class="col-span-full text-center text-red-500 bg-red-50 p-4 rounded-lg text-sm">O restaurante ainda não configurou as mesas.</div>';
          return;
      }

      slotsContainer.innerHTML = '';
      const lunchSlots = generateSlots(currentSettings.lunch);
      const dinnerSlots = generateSlots(currentSettings.dinner);
      const allSlots = [...lunchSlots, ...dinnerSlots];

      if (allSlots.length === 0) {
           slotsContainer.innerHTML = '<div class="col-span-full text-center text-gray-500 py-4">Não há horários disponíveis.</div>';
           return;
      }

      allSlots.forEach(time => {
          const slotBtn = document.createElement('button');
          slotBtn.type = 'button';
          slotBtn.className = 'py-3 px-2 rounded-lg border border-gray-200 text-sm font-medium transition-all hover:border-gold hover:bg-gold/5 active:scale-95 bg-neutral-50';
          slotBtn.textContent = time;

          const [h, m] = time.split(':').map(Number);
          const slotDateTime = new Date(dateStr);
          slotDateTime.setHours(h, m, 0, 0);
          
          const now = new Date();
          const minAdvanceMs = currentSettings.minAdvance * 60 * 1000;
          const isTooClosed = slotDateTime.getTime() - now.getTime() < minAdvanceMs;

          if (isTooClosed) {
              slotBtn.disabled = true;
              slotBtn.classList.add('bg-gray-100', 'text-gray-300', 'cursor-not-allowed', 'line-through');
          } else {
              const guestCount = parseInt(guestSelect.value);
              const currentSlotMin = h * 60 + m;
              const duration = currentSettings.resDuration || 60;
              
              const occupiedTableIds = [];
              takenSlots.forEach(res => {
                  if (res.assignedTable) {
                      const [extH, extM] = res.time.split(':').map(Number);
                      const extStartMin = extH * 60 + extM;
                      const extEndMin = extStartMin + duration;
                      
                      const newStartMin = currentSlotMin;
                      const newEndMin = newStartMin + duration;

                      if (extStartMin < newEndMin && newStartMin < extEndMin) {
                          const tableIds = res.assignedTable.split('+');
                          occupiedTableIds.push(...tableIds);
                      }
                  }
              });
              
              const availableTables = currentSettings.tables.filter(table => 
                  !occupiedTableIds.includes(table.id)
              );
              
              const isAvailable = canAccommodateGuests(guestCount, availableTables);

              if (!isAvailable) {
                  slotBtn.disabled = true;
                  slotBtn.classList.add('bg-gray-100', 'text-gray-300', 'cursor-not-allowed', 'line-through');
              } else {
                  slotBtn.onclick = () => selectSlot(slotBtn, time);
              }
          }

          slotsContainer.appendChild(slotBtn);
      });
  }

  function showError(msg) {
      slotsContainer.innerHTML = '';
      dateError.textContent = msg;
      dateError.classList.remove('hidden');
      dateInput.value = '';
  }

  function selectSlot(btn, time) {
    Array.from(slotsContainer.children).forEach((b: any) => {
        if (!b.disabled) b.className = 'py-3 px-2 rounded-lg border border-gray-200 text-sm font-medium transition-all hover:border-gold hover:bg-gold/5 active:scale-95 bg-neutral-50';
    });
    btn.className = 'py-3 px-2 rounded-lg border bg-gold text-white border-gold shadow-md transform scale-105';
    timeInput.value = time;
    contactStep.classList.remove('hidden');
    setTimeout(() => {
        contactStep.classList.add('opacity-100');
        contactStep.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }, 50);
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!timeInput.value) { alert('Por favor selecione um horário'); return; }
    loadingOverlay.classList.remove('hidden');
    loadingOverlay.classList.add('flex');

    try {
        const formData: any = {
            date: dateInput.value,
            time: timeInput.value,
            guests: parseInt(guestSelect.value) || 2,
            name: (document.getElementById('res-name') as HTMLInputElement).value,
            email: (document.getElementById('res-email') as HTMLInputElement).value,
            phone: (document.getElementById('res-phone') as HTMLInputElement).value,
            createdAt: new Date(),
            to: [(document.getElementById('res-email') as HTMLInputElement).value], 
            cc: [restaurantConfig.contact.email], 
            message: {
                subject: `Reserva Confirmada - ${restaurantConfig.name} (${dateInput.value})`,
                html: `
                    <div style="font-family: sans-serif; color: #333;">
                        <h2 style="color: #D4AF37;">Reserva Confirmada</h2>
                        <p>Olá <strong>${(document.getElementById('res-name') as HTMLInputElement).value}</strong>,</p>
                        <p>A sua reserva no <strong>${restaurantConfig.name}</strong> foi registada com sucesso.</p>
                        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
                        <ul>
                            <li><strong>Data:</strong> ${dateInput.value}</li>
                            <li><strong>Hora:</strong> ${timeInput.value}</li>
                            <li><strong>Pessoas:</strong> ${guestSelect.value}</li>
                        </ul>
                        <p>Se precisar de cancelar, por favor contacte-nos por telefone: ${restaurantConfig.contact.phone}.</p>
                        <p><em>Obrigado pela preferência!</em></p>
                    </div>
                `
            }
        };
        
        if (currentSettings.tables && currentSettings.tables.length > 0) {
            const guestCount = parseInt(guestSelect.value);
            const selectedTime = timeInput.value;
            const [newH, newM] = selectedTime.split(':').map(Number);
            const newStartMin = newH * 60 + newM;
            const duration = currentSettings.resDuration || 60;
            const newEndMin = newStartMin + duration;
            
            const q = query(
                collection(db, "reservations"), 
                where("date", "==", dateInput.value)
            );
            const snapshot = await getDocs(q);
            const occupiedTableIds = [];
            
            snapshot.forEach(doc => {
                const data = doc.data();
                if (data.assignedTable) {
                    const [extH, extM] = data.time.split(':').map(Number);
                    const extStartMin = extH * 60 + extM;
                    const extEndMin = extStartMin + duration;
                    
                    if (extStartMin < newEndMin && newStartMin < extEndMin) {
                        const tableIds = data.assignedTable.split('+');
                        occupiedTableIds.push(...tableIds);
                    }
                }
            });
            
            const allAvailableTables = currentSettings.tables.filter(t => !occupiedTableIds.includes(t.id));
            const solution = findBestTableSolution(guestCount, allAvailableTables);
            
            if (!solution) {
                alert('Desculpe, não há mesas disponíveis para este período. Por favor escolha outro horário.');
                loadingOverlay.classList.add('hidden');
                loadingOverlay.classList.remove('flex');
                return;
            }
            
            if (solution.tables.length === 1) {
                formData.assignedTable = solution.tables[0].id;
                formData.assignedTableName = solution.tables[0].name;
            } else {
                formData.assignedTable = solution.tables.map(t => t.id).join('+');
                formData.assignedTableName = solution.tables.map(t => t.name).join(' + ');
            }
        }

        await addDoc(collection(db, "reservations"), formData);
        form.classList.add('hidden');
        successMessage.classList.remove('hidden');

    } catch (err: any) {
        console.error("Error writing document: ", err);
        const errorMessage = (err && err.message) || String(err);
        const errorCode = (err && err.code) || 'unknown';
        
        alert(`Ocorreu um erro ao registar a reserva.\n\nDetalhes: ${errorMessage}\nCódigo: ${errorCode}`);
    } finally {
        loadingOverlay.classList.add('hidden');
        loadingOverlay.classList.remove('flex');
    }
  });

  resetButton.addEventListener('click', () => {
    form.reset();
    slotsContainer.innerHTML = '<div class="col-span-full text-gray-400 text-sm italic p-4 border border-dashed border-gray-200 rounded-lg text-center bg-neutral-50">Selecione uma data para ver disponibilidade</div>';
    timeInput.value = '';
    contactStep.classList.add('hidden', 'opacity-0');
    form.classList.remove('hidden');
    successMessage.classList.add('hidden');
  });

</script>
