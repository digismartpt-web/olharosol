import"./hoisted.BB7YPW27.js";import{c as ne,e as D,h as se,q as Q,f as N,w as U,k as W,l as oe}from"./firebase.CHVcsD2z.js";const z=document.querySelectorAll("[data-filter]"),k=Array.from(document.querySelectorAll(".gallery-item")),q=document.getElementById("gallery-prev"),$=document.getElementById("gallery-next"),F=document.getElementById("gallery-page-indicator"),J=document.getElementById("gallery-pagination");let T="Todos",m=1;const L=6;function B(){const a=k.filter(o=>T==="Todos"||o.dataset.category===T),e=Math.ceil(a.length/L)||1;m>e&&(m=e);const s=(m-1)*L,t=s+L;k.forEach(o=>o.style.display="none"),a.forEach((o,l)=>{l>=s&&l<t&&(o.style.display="block")}),F&&(F.textContent=`Página ${m} de ${e}`),q&&(q.disabled=m===1),$&&($.disabled=m===e),J&&(J.style.display=e>1?"flex":"none")}z.forEach(a=>{a.addEventListener("click",()=>{z.forEach(e=>{e.classList.remove("bg-primary","text-white"),e.classList.add("bg-white","text-gray-600")}),a.classList.remove("bg-white","text-gray-600"),a.classList.add("bg-primary","text-white"),T=a.dataset.filter,m=1,B()})});q?.addEventListener("click",()=>{m>1&&(m--,B(),document.getElementById("galeria").scrollIntoView({behavior:"smooth"}))});$?.addEventListener("click",()=>{const a=k.filter(s=>T==="Todos"||s.dataset.category===T).length,e=Math.ceil(a/L);m<e&&(m++,B(),document.getElementById("galeria").scrollIntoView({behavior:"smooth"}))});B();const M=document.getElementById("reservation-form"),p=document.getElementById("res-date"),b=document.getElementById("res-time"),v=document.getElementById("slots-container"),S=document.getElementById("contact-step"),j=document.getElementById("date-error"),X=document.getElementById("success-message"),re=document.getElementById("reset-form"),P=document.getElementById("loading-overlay"),f=document.getElementById("res-guests"),ie=30;let r={closedDays:[0,1],maxGuests:8,minAdvance:30,resDuration:60,vacationStart:null,vacationEnd:null,lunch:{start:12,end:15},dinner:{start:19,end:22},tables:[]};const le=ne(D,"settings","general");se(le,a=>{if(a.exists()){const e=a.data();e.closedDays&&(r.closedDays=e.closedDays),e.maxGuests&&(r.maxGuests=e.maxGuests),e.minAdvance!==void 0&&(r.minAdvance=e.minAdvance),e.resDuration!==void 0&&(r.resDuration=e.resDuration),r.vacationStart=e.vacationStart||null,r.vacationEnd=e.vacationEnd||null,e.lunchStart&&(r.lunch.start=e.lunchStart),e.lunchEnd&&(r.lunch.end=e.lunchEnd),e.dinnerStart&&(r.dinner.start=e.dinnerStart),e.dinnerEnd&&(r.dinner.end=e.dinnerEnd),r.tables=e.tables||[],ce(),p.value&&G(p.value)}});function ce(){const a=parseInt(f.value)||2;f.innerHTML="";for(let s=1;s<=r.maxGuests;s++){const t=document.createElement("option");t.value=s.toString(),t.textContent=s+(s===1?" Pessoa":" Pessoas"),f.appendChild(t)}const e=Math.min(a,r.maxGuests);f.value=e>0?e.toString():"1"}function de(a,e){if(e.find(o=>o.capacity>=a))return!0;const t=e.filter(o=>o.combinable!==!1);for(let o=0;o<t.length;o++)for(let l=o+1;l<t.length;l++)if(t[o].capacity+t[l].capacity>=a)return!0;if(t.length>=3){for(let o=0;o<t.length;o++)for(let l=o+1;l<t.length;l++)for(let d=l+1;d<t.length;d++)if(t[o].capacity+t[l].capacity+t[d].capacity>=a)return!0}return!1}function ue(a,e){const s=e.filter(n=>n.capacity>=a).sort((n,i)=>n.capacity-i.capacity);if(s.length>0)return{tables:[s[0]],totalCapacity:s[0].capacity};const t=e.filter(n=>n.combinable!==!1);let o=null,l=1/0;for(let n=0;n<t.length;n++)for(let i=n+1;i<t.length;i++){const u=t[n].capacity+t[i].capacity;u>=a&&u<l&&(o=[t[n],t[i]],l=u)}if(o)return{tables:o,totalCapacity:l};let d=null,c=1/0;if(t.length>=3)for(let n=0;n<t.length;n++)for(let i=n+1;i<t.length;i++)for(let u=i+1;u<t.length;u++){const g=t[n].capacity+t[i].capacity+t[u].capacity;g>=a&&g<c&&(d=[t[n],t[i],t[u]],c=g)}return d?{tables:d,totalCapacity:c}:null}function _(a){const e=[];let s=a.start*60;const t=a.end*60;for(;s<t;){const o=Math.floor(s/60),l=s%60,d=`${o.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`;e.push(d),s+=ie}return e}p.min=new Date().toISOString().split("T")[0];p.addEventListener("change",a=>{G(a.target.value)});f.addEventListener("change",()=>{p.value&&G(p.value)});async function G(a){if(!a)return;const s=new Date(a).getDay();if(v.innerHTML='<div class="col-span-4 text-center py-2"><span class="animate-pulse text-primary">Verificando disponibilidade...</span></div>',b.value="",S.classList.add("hidden"),j.classList.add("hidden"),r.closedDays.includes(s)){K("O restaurante encontra-se encerrado. Não é possível efetuar reservas.");return}if(r.vacationStart&&r.vacationEnd){const c=new Date(r.vacationStart),n=new Date(r.vacationEnd);c.setHours(0,0,0,0),n.setHours(23,59,59,999);const i=new Date(a);if(i.setHours(12,0,0,0),i>=c&&i<=n){K("Estamos encerrados para férias neste período.");return}}let t=[];try{const c=Q(N(D,"reservations"),U("date","==",a));(await W(c)).forEach(i=>{const u=i.data();t.push({time:u.time,assignedTable:u.assignedTable||null})})}catch(c){console.error("Error fetching availability:",c)}if(!r.tables||r.tables.length===0){v.innerHTML='<div class="col-span-4 text-center text-red-500 bg-red-50 p-4 rounded-lg border border-red-100 text-sm">O restaurante ainda não configurou as mesas. Por favor, tente mais tarde.</div>';return}v.innerHTML="";const o=_(r.lunch),l=_(r.dinner),d=[...o,...l];if(d.length===0){v.innerHTML='<div class="col-span-4 text-center text-gray-500 py-2">Não há horários disponíveis para hoje.</div>';return}d.forEach(c=>{const n=document.createElement("button");n.type="button",n.className="py-3 px-2 rounded-xl border text-sm font-medium transition-all hover:border-primary hover:bg-primary/5 active:scale-95 touch-manipulation",n.textContent=c;const[i,u]=c.split(":").map(Number),g=new Date(a);g.setHours(i,u,0,0);const C=new Date,y=r.minAdvance*60*1e3;if(g.getTime()-C.getTime()<y)n.disabled=!0,n.classList.add("bg-gray-100","text-gray-400","cursor-not-allowed","line-through"),n.title="Horário já passou ou muito próximo";else{const E=parseInt(f.value),A=i*60+u,w=r.resDuration||60,x=[];t.forEach(I=>{if(I.assignedTable){const[Y,Z]=I.time.split(":").map(Number),V=Y*60+Z,ee=V+w,R=A,te=R+w;if(V<te&&R<ee){const ae=I.assignedTable.split("+");x.push(...ae)}}});const H=r.tables.filter(I=>!x.includes(I.id));de(E,H)?n.onclick=()=>me(n,c):(n.disabled=!0,n.classList.add("bg-gray-100","text-gray-400","cursor-not-allowed","line-through"),n.title="Esgotado")}v.appendChild(n)})}function K(a){v.innerHTML="",j.textContent=a,j.classList.remove("hidden"),p.value=""}function me(a,e){Array.from(v.children).forEach(s=>{s.disabled||(s.className="py-3 px-2 rounded-xl border text-sm font-medium transition-all hover:border-primary hover:bg-primary/5 active:scale-95 touch-manipulation")}),a.className="py-3 px-2 rounded-xl border bg-primary text-white border-primary shadow-md transform scale-105 z-10",b.value=e,S.classList.remove("hidden"),setTimeout(()=>{S.classList.add("opacity-100"),S.scrollIntoView({behavior:"smooth",block:"nearest"})},50)}M.addEventListener("submit",async a=>{if(a.preventDefault(),!b.value){alert("Por favor selecione um horário");return}P.classList.remove("hidden");try{const e={date:p.value,time:b.value,guests:parseInt(f.value)||2,name:document.getElementById("res-name").value,email:document.getElementById("res-email").value,phone:document.getElementById("res-phone").value,createdAt:new Date,to:[document.getElementById("res-email").value],cc:["restaurantedomhenrique@iol.pt"],message:{subject:`Reserva Confirmada - Dom Henrique (${p.value})`,html:`
                    <div style="font-family: sans-serif; color: #333;">
                        <h2 style="color: #b91c1c;">Reserva Confirmada</h2>
                        <p>Olá <strong>${document.getElementById("res-name").value}</strong>,</p>
                        <p>A sua reserva no <strong>Restaurante Dom Henrique</strong> foi registada com sucesso.</p>
                        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
                        <ul>
                            <li><strong>Data:</strong> ${p.value}</li>
                            <li><strong>Hora:</strong> ${b.value}</li>
                            <li><strong>Pessoas:</strong> ${f.value}</li>
                        </ul>
                        <p>Se precisar de cancelar, por favor contacte-nos por telefone: 252 996 426.</p>
                        <p><em>Obrigado pela preferência!</em></p>
                    </div>
                `}};if(r.tables&&r.tables.length>0){const s=parseInt(f.value),t=b.value,[o,l]=t.split(":").map(Number),d=o*60+l,c=r.resDuration||60,n=d+c,i=Q(N(D,"reservations"),U("date","==",p.value)),u=await W(i),g=[];u.forEach(h=>{const E=h.data();if(E.assignedTable){const[A,w]=E.time.split(":").map(Number),x=A*60+w,H=x+c;if(x<n&&d<H){const O=E.assignedTable.split("+");g.push(...O)}}});const C=r.tables.filter(h=>!g.includes(h.id)),y=ue(s,C);if(!y){alert("Desculpe, não há mesas disponíveis para este período. Por favor escolha outro horário."),P.classList.add("hidden");return}y.tables.length===1?(e.assignedTable=y.tables[0].id,e.assignedTableName=y.tables[0].name):(e.assignedTable=y.tables.map(h=>h.id).join("+"),e.assignedTableName=y.tables.map(h=>h.name).join(" + "))}await oe(N(D,"reservations"),e),M.classList.add("hidden"),X.classList.remove("hidden")}catch(e){console.error("Error writing document: ",e),e&&typeof e=="object"?JSON.stringify(e):String(e);const s=e&&e.message||String(e),t=e&&e.code||"unknown";alert(`Ocorreu um erro ao registar a reserva.

Detalhes: ${s}
Código: ${t}

Por favor, tire uma captura de ecrã deste erro.`)}finally{P.classList.add("hidden")}});re.addEventListener("click",()=>{M.reset(),v.innerHTML='<div class="col-span-4 text-gray-400 text-sm italic p-2 border border-dashed rounded text-center">Selecione uma data para ver disponibilidade</div>',b.value="",S.classList.add("hidden","opacity-0"),M.classList.remove("hidden"),X.classList.add("hidden")});
