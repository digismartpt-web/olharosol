import{c as se,e as A,h as oe,q as U,f as k,w as W,k as X,l as re}from"./Header.astro_astro_type_script_index_0_lang.D_7A-guP.js";const _=document.querySelectorAll("[data-filter]"),H=Array.from(document.querySelectorAll(".gallery-item")),N=document.getElementById("gallery-prev"),O=document.getElementById("gallery-next"),F=document.getElementById("gallery-page-indicator"),J=document.getElementById("gallery-pagination");let T="Todos",u=1;const D=6;function M(){const a=H.filter(o=>T==="Todos"||o.dataset.category===T),e=Math.ceil(a.length/D)||1;u>e&&(u=e);const s=(u-1)*D,t=s+D;H.forEach(o=>o.style.display="none"),a.forEach((o,l)=>{l>=s&&l<t&&(o.style.display="block")}),F&&(F.textContent=`Página ${u} de ${e}`),N&&(N.disabled=u===1),O&&(O.disabled=u===e),J&&(J.style.display=e>1?"flex":"none")}_.forEach(a=>{a.addEventListener("click",()=>{_.forEach(e=>{e.classList.remove("bg-gold","text-white"),e.classList.add("bg-white","text-gray-600")}),a.classList.remove("bg-white","text-gray-600"),a.classList.add("bg-gold","text-white"),T=a.dataset.filter,u=1,M()})});N?.addEventListener("click",()=>{u>1&&(u--,M(),document.getElementById("galeria").scrollIntoView({behavior:"smooth"}))});O?.addEventListener("click",()=>{const a=H.filter(s=>T==="Todos"||s.dataset.category===T).length,e=Math.ceil(a/D);u<e&&(u++,M(),document.getElementById("galeria").scrollIntoView({behavior:"smooth"}))});M();const L={name:"Olhar o Sol",tagline:"Pizzaria & Kebab",description:"O melhor sabor da cozinha regional e tradicional. Pizzas deliciosas, kebabs fascinantes e um ambiente acolhedor.",heroText:"Experiência Gastronómica Única em Riba d'Ave",aboutTitle:"Sobre Nós",aboutText:["Situado em Riba d'Ave, o Olhar o Sol é o destino ideal para quem procura pizzas de qualidade, kebabs suculentos e uma atmosfera calma e amigável.","Com uma equipa dedicada e ingredientes frescos, proporcionamos momentos memoráveis a cada refeição.","Venha visitar-nos e descubra por que somos uma referência na região."],address:{street:"Rua das Agras n5",city:"Riba d'Ave",postalCode:"4765-181",country:"Portugal",googleMapsLink:"https://www.google.com/maps/place/Rua+das+Agras+5,+4765-181+Riba+de+Ave,+Portugal",embedLink:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2994.46!2d-8.38!3d41.3!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zNDHCsDE4JzAwLjAiTiA4wrAyMic0OC4wIlc!5e0!3m2!1spt!2spt!4v1711234567890!5m2!1spt!2spt"},contact:{phone:"+351 918 804 459",email:"olharosol.07@gmail.com",facebook:"https://www.facebook.com/pizzariaOlharoSol/",instagram:"https://www.instagram.com/olharosolpizzaria/"},hours:{lunch:"11:00 - 15:00",dinner:"18:00 - 23:00 (Sex/Sáb até 00:00)",days:"Quarta a Domingo",closed:"Folga à Segunda e Terça"},seo:{keywords:"pizzaria, kebabs, Riba d'Ave, restaurante, Olhar o Sol, pizza, gastronomia",author:"Olhar o Sol"},images:{logo:"/images/logo.png",hero:"/images/gallery/salle.jpg",cover:"/images/gallery/salle.jpg",gallery:[{src:"/images/gallery/pizza_italia.jpg",alt:"Pizza Itália"},{src:"/images/gallery/pates.jpg",alt:"Prato de Massas"},{src:"/images/gallery/viande.jpg",alt:"Prato de Carne"},{src:"/images/gallery/fruits_de_mer.jpg",alt:"Marisco"},{src:"/images/gallery/burger.jpg",alt:"Kebab Burger"},{src:"/images/gallery/pizza_detail.jpg",alt:"Pormenor de Pizza"},{src:"/images/gallery/salle.jpg",alt:"Nossa Sala"},{src:"/images/gallery/concert.jpg",alt:"Evento ao vivo"}]}},C=document.getElementById("reservation-form"),g=document.getElementById("res-date"),v=document.getElementById("res-time"),y=document.getElementById("slots-container"),S=document.getElementById("contact-step"),$=document.getElementById("date-error"),Y=document.getElementById("success-message"),ie=document.getElementById("reset-form"),j=document.getElementById("loading-overlay"),f=document.getElementById("res-guests"),le=30;let r={closedDays:[0,1],maxGuests:8,minAdvance:30,resDuration:60,vacationStart:null,vacationEnd:null,lunch:{start:12,end:15},dinner:{start:19,end:22},tables:[]};const ce=se(A,"settings","general");oe(ce,a=>{if(a.exists()){const e=a.data();e.closedDays&&(r.closedDays=e.closedDays),e.maxGuests&&(r.maxGuests=e.maxGuests),e.minAdvance!==void 0&&(r.minAdvance=e.minAdvance),e.resDuration!==void 0&&(r.resDuration=e.resDuration),r.vacationStart=e.vacationStart||null,r.vacationEnd=e.vacationEnd||null,e.lunchStart&&(r.lunch.start=e.lunchStart),e.lunchEnd&&(r.lunch.end=e.lunchEnd),e.dinnerStart&&(r.dinner.start=e.dinnerStart),e.dinnerEnd&&(r.dinner.end=e.dinnerEnd),r.tables=e.tables||[],de(),g.value&&q(g.value)}});function de(){const a=parseInt(f.value)||2;f.innerHTML="";for(let s=1;s<=r.maxGuests;s++){const t=document.createElement("option");t.value=s.toString(),t.textContent=s+(s===1?" Pessoa":" Pessoas"),f.appendChild(t)}const e=Math.min(a,r.maxGuests);f.value=e>0?e.toString():"1"}function me(a,e){if(e.find(o=>o.capacity>=a))return!0;const t=e.filter(o=>o.combinable!==!1);for(let o=0;o<t.length;o++)for(let l=o+1;l<t.length;l++)if(t[o].capacity+t[l].capacity>=a)return!0;if(t.length>=3){for(let o=0;o<t.length;o++)for(let l=o+1;l<t.length;l++)for(let d=l+1;d<t.length;d++)if(t[o].capacity+t[l].capacity+t[d].capacity>=a)return!0}return!1}function ue(a,e){const s=e.filter(n=>n.capacity>=a).sort((n,i)=>n.capacity-i.capacity);if(s.length>0)return{tables:[s[0]],totalCapacity:s[0].capacity};const t=e.filter(n=>n.combinable!==!1);let o=null,l=1/0;for(let n=0;n<t.length;n++)for(let i=n+1;i<t.length;i++){const m=t[n].capacity+t[i].capacity;m>=a&&m<l&&(o=[t[n],t[i]],l=m)}if(o)return{tables:o,totalCapacity:l};let d=null,c=1/0;if(t.length>=3)for(let n=0;n<t.length;n++)for(let i=n+1;i<t.length;i++)for(let m=i+1;m<t.length;m++){const p=t[n].capacity+t[i].capacity+t[m].capacity;p>=a&&p<c&&(d=[t[n],t[i],t[m]],c=p)}return d?{tables:d,totalCapacity:c}:null}function K(a){const e=[];let s=a.start*60;const t=a.end*60;for(;s<t;){const o=Math.floor(s/60),l=s%60,d=`${o.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`;e.push(d),s+=le}return e}g.min=new Date().toISOString().split("T")[0];g.addEventListener("change",a=>{q(a.target.value)});f.addEventListener("change",()=>{g.value&&q(g.value)});async function q(a){if(!a)return;const s=new Date(a).getDay();if(y.innerHTML='<div class="col-span-4 text-center py-2"><span class="animate-pulse text-gold">Verificando disponibilidade...</span></div>',v.value="",S.classList.add("hidden"),$.classList.add("hidden"),r.closedDays.includes(s)){Q("O restaurante encontra-se encerrado. Não é possível efetuar reservas.");return}if(r.vacationStart&&r.vacationEnd){const c=new Date(r.vacationStart),n=new Date(r.vacationEnd);c.setHours(0,0,0,0),n.setHours(23,59,59,999);const i=new Date(a);if(i.setHours(12,0,0,0),i>=c&&i<=n){Q("Estamos encerrados para férias neste período.");return}}let t=[];try{const c=U(k(A,"reservations"),W("date","==",a));(await X(c)).forEach(i=>{const m=i.data();t.push({time:m.time,assignedTable:m.assignedTable||null})})}catch(c){console.error("Error fetching availability:",c)}if(!r.tables||r.tables.length===0){y.innerHTML='<div class="col-span-4 text-center text-red-500 bg-red-50 p-4 rounded-lg border border-red-100 text-sm">O restaurante ainda não configurou as mesas. Por favor, tente mais tarde.</div>';return}y.innerHTML="";const o=K(r.lunch),l=K(r.dinner),d=[...o,...l];if(d.length===0){y.innerHTML='<div class="col-span-4 text-center text-gray-500 py-2">Não há horários disponíveis para hoje.</div>';return}d.forEach(c=>{const n=document.createElement("button");n.type="button",n.className="py-3 px-2 rounded-xl border text-sm font-medium transition-all hover:border-gold hover:bg-gold/5 active:scale-95 touch-manipulation",n.textContent=c;const[i,m]=c.split(":").map(Number),p=new Date(a);p.setHours(i,m,0,0);const z=new Date,h=r.minAdvance*60*1e3;if(p.getTime()-z.getTime()<h)n.disabled=!0,n.classList.add("bg-gray-100","text-gray-400","cursor-not-allowed","line-through"),n.title="Horário já passou ou muito próximo";else{const E=parseInt(f.value),B=i*60+m,I=r.resDuration||60,x=[];t.forEach(w=>{if(w.assignedTable){const[Z,ee]=w.time.split(":").map(Number),R=Z*60+ee,te=R+I,V=B,ae=V+I;if(R<ae&&V<te){const ne=w.assignedTable.split("+");x.push(...ne)}}});const P=r.tables.filter(w=>!x.includes(w.id));me(E,P)?n.onclick=()=>ge(n,c):(n.disabled=!0,n.classList.add("bg-gray-100","text-gray-400","cursor-not-allowed","line-through"),n.title="Esgotado")}y.appendChild(n)})}function Q(a){y.innerHTML="",$.textContent=a,$.classList.remove("hidden"),g.value=""}function ge(a,e){Array.from(y.children).forEach(s=>{s.disabled||(s.className="py-3 px-2 rounded-xl border text-sm font-medium transition-all hover:border-gold hover:bg-gold/5 active:scale-95 touch-manipulation")}),a.className="py-3 px-2 rounded-xl border bg-gold text-white border-gold shadow-md transform scale-105 z-10",v.value=e,S.classList.remove("hidden"),setTimeout(()=>{S.classList.add("opacity-100"),S.scrollIntoView({behavior:"smooth",block:"nearest"})},50)}C.addEventListener("submit",async a=>{if(a.preventDefault(),!v.value){alert("Por favor selecione um horário");return}j.classList.remove("hidden");try{const e={date:g.value,time:v.value,guests:parseInt(f.value)||2,name:document.getElementById("res-name").value,email:document.getElementById("res-email").value,phone:document.getElementById("res-phone").value,createdAt:new Date,to:[document.getElementById("res-email").value],cc:[L.contact.email],message:{subject:`Reserva Confirmada - ${L.name} (${g.value})`,html:`
                    <div style="font-family: sans-serif; color: #333;">
                        <h2 style="color: #D4AF37;">Reserva Confirmada</h2>
                        <p>Olá <strong>${document.getElementById("res-name").value}</strong>,</p>
                        <p>A sua reserva no <strong>${L.name}</strong> foi registada com sucesso.</p>
                        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
                        <ul>
                            <li><strong>Data:</strong> ${g.value}</li>
                            <li><strong>Hora:</strong> ${v.value}</li>
                            <li><strong>Pessoas:</strong> ${f.value}</li>
                        </ul>
                        <p>Se precisar de cancelar, por favor contacte-nos por telefone: ${L.contact.phone}.</p>
                        <p><em>Obrigado pela preferência!</em></p>
                    </div>
                `}};if(r.tables&&r.tables.length>0){const s=parseInt(f.value),t=v.value,[o,l]=t.split(":").map(Number),d=o*60+l,c=r.resDuration||60,n=d+c,i=U(k(A,"reservations"),W("date","==",g.value)),m=await X(i),p=[];m.forEach(b=>{const E=b.data();if(E.assignedTable){const[B,I]=E.time.split(":").map(Number),x=B*60+I,P=x+c;if(x<n&&d<P){const G=E.assignedTable.split("+");p.push(...G)}}});const z=r.tables.filter(b=>!p.includes(b.id)),h=ue(s,z);if(!h){alert("Desculpe, não há mesas disponíveis para este período. Por favor escolha outro horário."),j.classList.add("hidden");return}h.tables.length===1?(e.assignedTable=h.tables[0].id,e.assignedTableName=h.tables[0].name):(e.assignedTable=h.tables.map(b=>b.id).join("+"),e.assignedTableName=h.tables.map(b=>b.name).join(" + "))}await re(k(A,"reservations"),e),C.classList.add("hidden"),Y.classList.remove("hidden")}catch(e){console.error("Error writing document: ",e),e&&typeof e=="object"?JSON.stringify(e):String(e);const s=e&&e.message||String(e),t=e&&e.code||"unknown";alert(`Ocorreu um erro ao registar a reserva.

Detalhes: ${s}
Código: ${t}

Por favor, tire uma captura de ecrã deste erro.`)}finally{j.classList.add("hidden")}});ie.addEventListener("click",()=>{C.reset(),y.innerHTML='<div class="col-span-4 text-gray-400 text-sm italic p-2 border border-dashed rounded text-center">Selecione uma data para ver disponibilidade</div>',v.value="",S.classList.add("hidden","opacity-0"),C.classList.remove("hidden"),Y.classList.add("hidden")});
